#!/bin/sh
#
# job name (default is the name of pbs script file)
#---------------------------------------------------
#PBS -N job_name
#
# Submit the job to the queue "queue_name" (minerva_h_p, gpu_l_p)
#---------------------------------------------------
#PBS -q  {{ queue_name }}
#
# Send the mail messages (see below) to the specified user address 
#-----------------------------------------------------------------
#PBS -M amitibo@tx.technion.ac.il
#
# send me mail when the job begins, when the job ends
# and when the job aborts (with an error)
#---------------------------------------------------
#PBS -mbea
#
#
# resource limits: number and distribution of parallel processes 
#------------------------------------------------------------------ 
#PBS -l select={{ M }}:ncpus={{ N }}:mpiprocs={{ N }}
#
# comment: this select statement means: use M chunks (nodes), 
# use N (=< 12) CPUs for N mpi tasks on each of M nodes. 
# "scatter" will use exactly N CPUs from each node, while omitting 
# "-l place" statement will fill all available CPUs of M nodes 
#  
#  specifying working directory
#------------------------------------------------------
PBS_O_WORKDIR={{ work_directory }}
cd $PBS_O_WORKDIR

#
# running MPI executable with M*N processes  
#------------------------------------------------------
mpirun -np {{ M * N }}  {{ cmd }}  {{ params }}

# comment: the "np" must be equal the number of chunks multiplied by the number of "ncpus"
